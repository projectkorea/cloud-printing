import{r as i,c as t,h as s,H as e}from"./p-2fd75363.js";import{a as n,E as o}from"./p-66ea82f4.js";import{i as h}from"./p-bb067c01.js";let a=class{constructor(s){i(this,s),this.authCancel=t(this,"authCancel",7),this.authSuccess=t(this,"authSuccess",7),this.oauthPopupWindow=null,this.previousUrl=null}listenDialogAction(){this.openSignInWindow(this.auth.authURI.toString(),"ezeep Login")}listenDialogClose(){this.authCancel.emit()}listenStatusCancel(){this.authCancel.emit()}openSignInWindow(i,t){if(n.state.isAuthorized)return this.authCancel.emit(),void this.authSuccess.emit();window.removeEventListener("message",this.receiveMessage);const s="toolbar=no, menubar=no, width=600, height=7000, top=100, left=100";null===this.oauthPopupWindow||this.oauthPopupWindow.closed?this.oauthPopupWindow=window.open(i,t,s):this.previousUrl!==this.auth.authURI.toString()?(this.oauthPopupWindow=window.open(i,t,s),this.oauthPopupWindow&&!this.oauthPopupWindow.closed&&void 0!==this.oauthPopupWindow.closed||alert("popup blocked"),this.oauthPopupWindow.focus()):this.oauthPopupWindow.focus(),window.addEventListener("message",(i=>this.receiveMessage(i)),!1),this.previousUrl=this.auth.authURI}receiveMessage(i){n.state.code=i.data,this.auth.getAccessToken().then((()=>{this.authCancel.emit(),this.authSuccess.emit()}))}async componentWillLoad(){this.auth=new o(this.redirectURI,this.clientID),this.code&&(n.state.code=this.code,await this.auth.getAccessToken(),this.authCancel.emit(),this.authSuccess.emit()),!1===n.state.isAuthorized&&(this.auth.generateCodeVerifier(),await this.auth.generateCodeChallenge(n.state.codeVerifier),this.auth.buildAuthURI()),this.hidelogin&&"button"===this.trigger&&this.openSignInWindow(this.auth.authURI.toString(),"ezeep Login")}render(){return s(e,null,this.hidelogin&&"button"===this.trigger?s("ezp-status",{description:h.t("login_dialog.action"),processing:!0,cancel:!0}):this.hidelogin&&"file"===this.trigger?s("ezp-text-button",{type:"button",level:"primary",onClick:()=>this.openSignInWindow(this.auth.authURI.toString(),"ezeep Login"),label:h.t("button_actions.select_printer")}):s("ezp-dialog",{heading:h.t("login_dialog.heading"),description:h.t("login_dialog.description"),action:h.t("login_dialog.action"),iconName:"logo",iconSize:"huge",iconFramed:!1,instance:"login"}))}};a.style=":host{--ezp-theme-solid:var(--ezp-accent-cyan-solid);--ezp-theme-translucent:var(--ezp-accent-cyan-translucent);display:block}";export{a as ezp_auth}