var __awaiter=this&&this.__awaiter||function(e,t,r,n){function o(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n["throw"](e))}catch(e){i(e)}}function c(e){e.done?r(e.value):o(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};System.register(["./p-eef094b0.system.js","./p-917f930c.system.js"],(function(e){"use strict";var t,r;return{setters:[function(e){t=e.g;r=e.f},function(){}],execute:function(){var n=this;var o=function(e,t,r){var n=e.get(t);if(!n){e.set(t,[r])}else if(!n.includes(r)){n.push(r)}};var i=function(e,t){var r;return function(){var n=[];for(var o=0;o<arguments.length;o++){n[o]=arguments[o]}if(r){clearTimeout(r)}r=setTimeout((function(){r=0;e.apply(void 0,n)}),t)}};var a=function(e){return!("isConnected"in e)||e.isConnected};var s=i((function(e){for(var t=0,r=e.keys();t<r.length;t++){var n=r[t];e.set(n,e.get(n).filter(a))}}),2e3);var c=function(e){var n=e.on;var i=new Map;if(typeof t==="function"){n("dispose",(function(){i.clear()}));n("get",(function(e){var r=t();if(r){o(i,e,r)}}));n("set",(function(e){var t=i.get(e);if(t){i.set(e,t.filter(r))}s(i)}));n("reset",(function(){i.forEach((function(e){return e.forEach(r)}));s(i)}))}};var u=function(e,t){if(t===void 0){t=function(e,t){return e!==t}}var r=new Map(Object.entries(e!==null&&e!==void 0?e:{}));var n={dispose:[],get:[],set:[],reset:[]};var o=function(){r=new Map(Object.entries(e!==null&&e!==void 0?e:{}));n.reset.forEach((function(e){return e()}))};var i=function(){n.dispose.forEach((function(e){return e()}));o()};var a=function(e){n.get.forEach((function(t){return t(e)}));return r.get(e)};var s=function(e,o){var i=r.get(e);if(t(o,i,e)){r.set(e,o);n.set.forEach((function(t){return t(e,o,i)}))}};var c=typeof Proxy==="undefined"?{}:new Proxy(e,{get:function(e,t){return a(t)},ownKeys:function(e){return Array.from(r.keys())},getOwnPropertyDescriptor:function(){return{enumerable:true,configurable:true}},has:function(e,t){return r.has(t)},set:function(e,t,r){s(t,r);return true}});var u=function(e,t){n[e].push(t);return function(){f(n[e],t)}};var h=function(t,r){var n=u("set",(function(e,n){if(e===t){r(n)}}));var o=u("reset",(function(){return r(e[t])}));return function(){n();o()}};var l=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e.forEach((function(e){if(e.set){u("set",e.set)}if(e.get){u("get",e.get)}if(e.reset){u("reset",e.reset)}}))};var d=function(e){var t=r.get(e);n.set.forEach((function(r){return r(e,t,t)}))};return{state:c,get:a,set:s,on:u,onChange:h,use:l,dispose:i,reset:o,forceUpdate:d}};var f=function(e,t){var r=e.indexOf(t);if(r>=0){e[r]=e[e.length-1];e.length--}};var h=e("c",(function(e,t){var r=u(e,t);c(r);return r}));function l(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}var d=e("p",(function(e){var t=e.fn,r=e.validate,o=e.interval,i=e.maxAttempts;return __awaiter(n,void 0,void 0,(function(){var e,n;var a=this;return __generator(this,(function(s){e=0;n=function(s,c){return __awaiter(a,void 0,void 0,(function(){var a;return __generator(this,(function(u){switch(u.label){case 0:return[4,t()];case 1:a=u.sent();e++;if(r(a)){return[2,s(a)]}else if(i&&e===i){return[2,c(new Error("Exceeded max attempts."))]}else{setTimeout(n,o,s,c)}return[2]}}))}))};return[2,new Promise(n)]}))}))}));var p=e("r",(function(e){var t={};Object.keys(e).forEach((function(r){if(e[r]!==""){t[r]=e[r]}}));return t}));var v=function(){function e(e,t){this.urlParams=new URLSearchParams;this.isAuthorized=false;this.redirectURI=e;this.clientID=t;this.oauthUrl=g.state.authApiHostUrl;this.authURI=new URL("https://".concat(this.oauthUrl,"/oauth/authorize/"));this.accessTokenURL="https://".concat(this.oauthUrl,"/oauth/access_token/")}e.prototype.generateCodeVerifier=function(){if(g.state.codeVerifier!==""){this.codeVerifier=g.state.codeVerifier}else{var e=new Uint8Array(128);var t=crypto.getRandomValues(e);var r=btoa(t.toString()).substr(0,128);this.codeVerifier=r;g.state.codeVerifier=this.codeVerifier}};e.prototype.generateCodeChallenge=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n,o;return __generator(this,(function(i){switch(i.label){case 0:t=new TextEncoder;r=t.encode(e);return[4,crypto.subtle.digest("SHA-256",r)];case 1:n=i.sent();o=btoa(String.fromCharCode.apply(null,new Uint8Array(n)));this.codeChallenge=o.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return[2]}}))}))};e.prototype.buildAuthURI=function(){this.urlParams.append("response_type","code");this.urlParams.append("client_id",this.clientID);this.urlParams.append("redirect_uri",this.redirectURI);this.urlParams.append("code_challenge",this.codeChallenge);this.urlParams.append("code_challenge_method","S256");this.authURI.search=this.urlParams.toString();g.state.authUri=this.authURI.toString()};e.prototype.getAccessToken=function(){var e=this;return fetch(this.accessTokenURL,{credentials:"include",headers:{Authorization:"Basic "+btoa(this.clientID+":"),"Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:l({grant_type:"authorization_code",scope:"printing",code:g.state.code,redirect_uri:this.redirectURI})}).then((function(e){return e.json()})).then((function(t){if(t.access_token){g.state.isAuthorized=true;e.isAuthorized=g.state.isAuthorized;localStorage.setItem("isAuthorized",e.isAuthorized.toString());e.accessToken=t.access_token;localStorage.setItem("access_token",e.accessToken);g.state.accessToken=e.accessToken;e.refreshToken=t.refresh_token;localStorage.setItem("refreshToken",e.refreshToken);g.state.refreshToken=e.refreshToken}}))};e.prototype.refreshTokens=function(){var e=this;fetch(this.accessTokenURL,{credentials:"include",headers:{Authorization:"Basic "+btoa(this.clientID+":"),"Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:l({grant_type:"refresh_token",scope:"printing",refresh_token:g.state.refreshToken})}).then((function(e){return e.json()})).then((function(t){if(t.access_token){e.accessToken=t.access_token;localStorage.setItem("access_token",e.accessToken);g.state.accessToken=e.accessToken;e.refreshToken=t.refresh_token;localStorage.setItem("refreshToken",e.refreshToken);g.state.refreshToken=e.refreshToken;g.state.isAuthorized=true}}))};e.prototype.revokeRefreshToken=function(){if(g.state.refreshToken)fetch("https://".concat(this.oauthUrl,"/oauth/revoke/"),{credentials:"include",headers:{Authorization:"Basic "+btoa(this.clientID+":"),"Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:l({token:g.state.refreshToken})}).catch((function(e){console.log(e)}))};return e}();e("E",v);var g=e("a",h({code:"",codeVerifier:"",accessToken:"",refreshToken:"",isAuthorized:false,devApi:false,authApiHostUrl:"",redirectUri:"",authUri:""}))}}}));